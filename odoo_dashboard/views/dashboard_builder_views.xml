<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="view_dashboard_user_list" model="ir.ui.view">
        <field name="name">view.dashboard.user.list</field>
        <field name="model">res.users</field>
        <field name="priority">10000</field>
        <field name="arch" type="xml">
            <tree create="false" edit="false" delete="false">
                <field name="name" string="User Name"/>
                <field name="company_id"/>
            </tree>
        </field>
    </record>

    <record id="view_dashboard_board_list" model="ir.ui.view">
        <field name="name">view.dashboard.board.list</field>
        <field name="model">bi.dashboard.board</field>
        <field name="arch" type="xml">
            <tree default_order="name asc">
                <field name="name"/>
                <!--                <field name="active" widget="boolean_toggle"/>-->
                <!--                <field name="user_id" string="Owner"/>-->
                <field name="create_date"/>
                <field name="create_uid"/>
            </tree>
        </field>
    </record>

    <record id="view_dashboard_board_form" model="ir.ui.view">
        <field name="name">view.dashboard.board.form</field>
        <field name="model">bi.dashboard.board</field>
        <field name="priority">1000</field>
        <field name="arch" type="xml">
            <form delete="false">
                <header class="oe_read_only">
                    <button
                            string="Apply changes for all users"
                            class="btn btn-secondary"
                            name="action_apply_layout"
                            type="object"
                            attrs="{'invisible': [('is_updated', '=', True)]}">
                    </button>
                    <button
                            string="Apply changes for all users"
                            class="btn btn-primary"
                            name="action_apply_layout"
                            type="object"
                            attrs="{'invisible': [('is_updated', '=', False)]}">
                    </button>
                    <field name="is_updated" invisible="1"/>
                </header>
                <sheet>
                    <field name="board_layout_id" invisible="1"/>
                    <div class="oe_button_box" name="button_box">
                        <button
                                string="Layout Preview"
                                class="oe_stat_button"
                                name="action_preview_board_layout"
                                icon="fa-tachometer" type="object"
                                attrs="{'invisible': [('board_layout_id', '=', False)]}">
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>
                    <group>
                        <group attrs="{'invisible': [('id','=', False)]}">
                            <field name="create_date"/>
                            <field name="create_uid" widget="many2one_avatar_user"/>
                        </group>
                        <group>
                            <!--                            <field name="eligible_item_ids" invisible="1"/>-->
                            <field name="filter_type_ids" widget="many2many_tags"
                                   options="{'no_create_edit': True, 'no_create': True}"/>
                            <field name="menu_name" groups="odoo_dashboard_builder.dashboard_group_manager"/>
                            <field name="menu_sequence" groups="odoo_dashboard_builder.dashboard_group_manager"/>
                            <field name="parent_menu_id" groups="odoo_dashboard_builder.dashboard_group_manager"
                                   domain="['|', ('parent_id', '=', False), ('action', '=', False)]"
                                   options="{'no_create_edit': True, 'no_create': True}"/>
                        </group>
                    </group>
                    <group>
                        <notebook>
                            <page id="items" string="Dashboard Items">
                                <field name="dashboard_item_ids"
                                       domain="['|', ('allowed_user_ids', 'in', [uid]), ('create_uid', '=', uid)]">
                                    <tree editable="bottom" create="false" delete="true">
                                        <field name="name"/>
                                        <!--                                        <field name="layout_template"/>-->
                                        <field name="description"
                                               style="max-width:250px; overflow:hidden;white-space:nowrap;text-overflow:ellipsis;"/>
                                        <!--                                        <field name="active" widget="boolean_toggle" class="oe_read_only"/>-->
                                    </tree>
                                </field>
                            </page>
                            <page id="board_configurations" string="Configurations"
                                  groups="odoo_dashboard_builder.dashboard_group_manager">
                                <group>
                                    <field name="allowed_group_ids"
                                           options="{'no_create_edit': True, 'no_create': True, 'no_open': True}"
                                           widget="many2many_tags">
                                    </field>
                                    <field name="allowed_user_ids"
                                           domain="[('is_dashboard_user', '=', True)]"
                                           widget="many2many_tags"
                                           context="{'tree_view_ref': 'odoo_dashboard_builder.view_dashboard_user_list'}"
                                           options="{'no_create_edit': True, 'no_create': True}">
                                    </field>
                                </group>
                            </page>
                        </notebook>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_dashboard_board_user_form" model="ir.ui.view">
        <field name="name">view.dashboard.board.form</field>
        <field name="model">bi.dashboard.board</field>
        <field name="inherit_id" ref="odoo_dashboard_builder.view_dashboard_board_form"/>
        <field name="priority">1</field>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="attrs">{'readonly': [('id','!=', False)]}</attribute>
            </xpath>
            <xpath expr="//button[@name='action_preview_board_layout']" position="replace">
            </xpath>
            <xpath expr="//field[@name='menu_name']" position='replace'>
                <field name="menu_name" attrs="{'readonly': [('id','!=', False)]}"/>
            </xpath>
            <xpath expr="//field[@name='menu_sequence']" position='replace'>
                <field name="menu_sequence" attrs="{'readonly': [('id','!=', False)]}"/>
            </xpath>
            <xpath expr="//field[@name='parent_menu_id']" position='replace'>
                <field name="parent_menu_id"
                       attrs="{'readonly': [('id','!=', False)]}"
                       domain="['|', ('parent_id', '=', False), ('action', '=', False)]"
                       options="{'no_create_edit': True, 'no_create': True}"/>
            </xpath>
            <xpath expr="//page[@id='board_configurations']" position="replace"></xpath>
            <xpath expr="//field[@name='dashboard_item_ids']" position="attributes">
                <attribute name="domain">['|', ('allowed_user_ids', 'in', [uid]), ('create_uid', '=', uid)]</attribute>
                <attribute name="attrs">{'readonly': [('id','!=', False)]}</attribute>
            </xpath>
        </field>
    </record>


    <record id="view_dashboard_board_search" model="ir.ui.view">
        <field name="model">bi.dashboard.board</field>
        <field name="arch" type="xml">
            <search string="Dashboard Boards">
                <field name="name"/>
                <!--                <filter string="Archived" name="archived_boards" domain="[('active', '=', False)]"/>-->
            </search>
        </field>
    </record>

    <record id="view_dashboard_item_list" model="ir.ui.view">
        <field name="name">view.dashboard.item.list</field>
        <field name="model">bi.dashboard.item</field>
        <field name="arch" type="xml">
            <tree default_order="name asc">
                <field name="name"/>
                <!--                <field name="layout_template" readonly="1"/>-->
                <field name="description"/>
                <!--                <field name="user_id" readonly="1"/>-->
                <!--                <field name="active" widget="boolean_toggle"/>-->
                <field name="create_date"/>
                <field name="create_uid"/>
            </tree>
        </field>
    </record>

    <record id="view_dashboard_item_form" model="ir.ui.view">
        <field name="name">view.dashboard.item.form</field>
        <field name="model">bi.dashboard.item</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name"/>
                        </h1>
                    </div>
                    <div class="base-preview row m-0">
                        <div class="col-md-5">
                            <group>
                                <field name="created_on_ui" invisible="1" force_save="1"/>
                                <field name="compute_function" invisible="1" force_save="1"/>
                                <field name="x_position" invisible="1"/>
                                <field name="y_position" invisible="1"/>
                                <field name="width" invisible="1"/>
                                <field name="height" invisible="1"/>
                                <field name="min_width" invisible="1"/>
                                <field name="min_height" invisible="1"/>
                                <field name="summarized_table" invisible="1"/>
                                <field name="created_on_ui" invisible="1"/>
                                <field name="board_ids" widget="many2many_tags"
                                       options="{'no_create': True, 'no_open': True, 'no_create_edit': True}"/>
                                <field name="description"/>
                                <field name="layout_template"
                                       attrs="{'readonly':[('created_on_ui', '=', False)]}"/>
                                <field name="model_id"
                                       attrs="{'invisible':[('created_on_ui', '=', False)], 'required': [('created_on_ui', '=', True)]}"
                                       options="{'no_create': True, 'no_open': True, 'no_create_edit': True}"/>
                                <field name="measure_type"
                                       attrs="{'invisible':['|',('created_on_ui', '=', False),('layout_template','=','list')],
                                       'required': [('created_on_ui', '=', True), ('layout_template','!=','list')]}"/>
                                <field name="date_field_id"
                                       attrs="{'invisible':[('created_on_ui', '=', False)]}"
                                       options="{'no_create': True, 'no_open': True, 'no_create_edit': True}"/>
                                <field name="model_name" invisible="1"/>
                                <field name="item_domain" widget="domain"
                                       attrs="{'invisible':[('created_on_ui', '=', False)]}"
                                       options="{'model': 'model_name', 'in_dialog': True}"/>
                                <field name="format_style"
                                       attrs="{'invisible':[('layout_template', '=', 'gauge_mixed')]}"/>
                                <field name="custom_unit_style"
                                       attrs="{'required':[('format_style','=','custom')],'invisible':['|', ('format_style','!=','custom'), ('layout_template', '=', 'gauge_mixed')]}"/>

                            </group>
                        </div>
                        <div class="dashboard_builder_preview offset-md-1 col-md-6">
                            <field nolabel='1' name="preview" widget="omni_dashboard_preview"/>
                        </div>
                    </div>
                    <notebook>
                        <page string="KPI Configurations"
                              attrs="{'invisible':[('layout_template','not in', ['kpi', 'mixed', 'gauge_mixed'])]}">
                            <group>
                                <group>
                                    <field name="kpi_field_id"
                                           attrs="{'invisible':[('created_on_ui', '=', False)], 'required': [('layout_template','in', ['kpi', 'mixed', 'gauge_mixed']), ('created_on_ui', '=', True)]}"
                                           options="{'no_create': True, 'no_open': True, 'no_create_edit': True}"/>
                                    <field name="kpi_show_indicator" widget="boolean_toggle"/>
                                    <field name="green_on_positive" widget="boolean_toggle"
                                           attrs="{'invisible':[('kpi_show_indicator','=',False)]}"/>
                                    <field name="is_show_target" widget="boolean_toggle"
                                       attrs="{'invisible':[('layout_template','!=','kpi')]}"/>
                                    <field name="target_kpi_ids"
                                           attrs="{'invisible':['|',('is_show_target' ,'=', False),('layout_template','!=','kpi')]}">
                                        <tree editable="bottom">
                                            <field name="period_id" domain="[('id', 'not in', remaining_period_option_ids)]"/>
                                            <field name="target"/>
                                            <field name="remaining_period_option_ids" invisible="1"/>
                                        </tree>
                                    </field>
                                </group>
                                <group attrs="{'invisible':[('layout_template', '!=', 'kpi')]}">
                                    <field name="kpi_img_b64" string="KPI Icon"
                                           widget="image" options="{'size': [70, 70]}"/>
                                </group>
                            </group>
                        </page>

                        <page string="Chart Configurations"
                              attrs="{'invisible':['|', ('layout_template','not in', ['chart', 'mixed']), ('created_on_ui', '=', False)]}">
                            <group>
                                <group>
                                    <field name="chart_type"
                                           attrs="{'required': [('layout_template','in', ['chart', 'mixed']), ('created_on_ui', '=', True)]}"/>
                                    <field name="chart_field_ids" widget="many2many_tags"
                                           attrs="{'required': [('layout_template','in', ['chart', 'mixed']), ('created_on_ui', '=', True)]}"
                                           options="{'no_create': True, 'no_open': True, 'no_create_edit': True}"/>
                                    <field name="group_field_ids" widget="many2many_tags"
                                           options="{'no_create': True, 'no_open': True, 'no_create_edit': True}"/>
                                    <field name="order_field_ids" widget="many2many_tags"
                                           domain="['|', ('id', 'in', chart_field_ids), ('id', 'in', group_field_ids)]"
                                           options="{'no_create': True, 'no_open': True, 'no_create_edit': True}"/>
                                    <field name="order_method"
                                           attrs="{'invisible':[('order_field_ids', '=', False)]}"/>
                                </group>
                            </group>
                        </page>
                        <page string="List Configurations"
                              attrs="{'invisible':['|', ('layout_template','!=', 'list'), ('created_on_ui', '=', False)]}">
                            <group>
                                <field name="list_field_ids" label="0">
                                    <tree name="List View Options" create="true" editable="bottom">
                                        <field name="sequence"/>
                                        <field name="field" domain="[('model_id', '=', parent.model_id)]"
                                               options="{'no_create_edit': True, 'no_create': True}" required='1'/>
                                        <field name="custom_widget"/>
                                        <field name="related_field"
                                               attrs="{'readonly':['|', ('custom_widget','=', False), ('custom_widget','=', 'cell_percent')]}"
                                               domain="[('id','in',compute_satisfy)]"/>
                                        <field name="is_trigger_open" widget="boolean_toggle"/>
                                        <field name="compute_satisfy" invisible="1"/>
                                    </tree>
                                </field>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_dashboard_item_search" model="ir.ui.view">
        <field name="model">bi.dashboard.item</field>
        <field name="arch" type="xml">
            <search string="Dashboard Items">
                <field name="name"/>
                <filter string="Archived" name="archived_boards" domain="[('active', '=', False)]"/>
            </search>
        </field>
    </record>
</odoo>